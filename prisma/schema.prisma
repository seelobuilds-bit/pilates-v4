generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  HQ_ADMIN
  OWNER
  TEACHER
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  role      Role     @default(OWNER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  ownedStudio Studio?
  teacher     Teacher?
}

model Studio {
  id           String   @id @default(cuid())
  name         String
  subdomain    String   @unique
  primaryColor String?  @default("#7c3aed")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  ownerId String @unique
  owner   User   @relation(fields: [ownerId], references: [id])

  locations     Location[]
  classTypes    ClassType[]
  teachers      Teacher[]
  clients       Client[]
  classSessions ClassSession[]
  bookings      Booking[]
}

model Location {
  id        String   @id @default(cuid())
  name      String
  address   String
  city      String
  state     String
  zipCode   String
  phone     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  studioId String
  studio   Studio @relation(fields: [studioId], references: [id], onDelete: Cascade)

  classSessions ClassSession[]
}

model ClassType {
  id          String   @id @default(cuid())
  name        String
  description String?
  duration    Int      @default(60)
  capacity    Int      @default(10)
  price       Float
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  studioId String
  studio   Studio @relation(fields: [studioId], references: [id], onDelete: Cascade)

  classSessions ClassSession[]
}

model Teacher {
  id          String   @id @default(cuid())
  bio         String?
  specialties String[]
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  studioId String
  studio   Studio @relation(fields: [studioId], references: [id], onDelete: Cascade)

  classSessions ClassSession[]
}

model Client {
  id         String   @id @default(cuid())
  email      String
  password   String?
  firstName  String
  lastName   String
  phone      String?
  isActive   Boolean  @default(true)
  credits    Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  studioId String
  studio   Studio @relation(fields: [studioId], references: [id], onDelete: Cascade)

  bookings Booking[]

  @@unique([email, studioId])
}

model ClassSession {
  id        String   @id @default(cuid())
  startTime DateTime
  endTime   DateTime
  capacity  Int
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  studioId    String
  studio      Studio    @relation(fields: [studioId], references: [id], onDelete: Cascade)
  classTypeId String
  classType   ClassType @relation(fields: [classTypeId], references: [id])
  teacherId   String
  teacher     Teacher   @relation(fields: [teacherId], references: [id])
  locationId  String
  location    Location  @relation(fields: [locationId], references: [id])

  bookings Booking[]
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

model Booking {
  id         String        @id @default(cuid())
  status     BookingStatus @default(PENDING)
  paidAmount Float?
  notes      String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  studioId       String
  studio         Studio       @relation(fields: [studioId], references: [id], onDelete: Cascade)
  clientId       String
  client         Client       @relation(fields: [clientId], references: [id])
  classSessionId String
  classSession   ClassSession @relation(fields: [classSessionId], references: [id])
}
